(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{2020:function(e,t){window.hlsMuxer=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var a=r(2);function n(){}var i={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=i;function o(e,t){return"["+e+"] > "+t}var u=Object(a.a)();var c=function(e){if(u.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];r.forEach((function(t){s[t]=e[t]?e[t].bind(e):function(e){var t=u.console[e];return t?function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];a[0]&&(a[0]=o(e,a[0])),t.apply(u.console,a)}:n}(t)}))}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},l=s},function(e,t,r){"use strict";t.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(e,t,r){"use strict";function a(){return"undefined"==typeof window?self:window}r.d(t,"a",(function(){return a}))},function(e,t,r){"use strict";var a=r(1),n="mediaError",i="muxError",s="fragDecryptError",o="fragParsingError",u="remuxAllocError";function c(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.aesIV=r}var t,r;return t=e,(r=[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}])&&c(t.prototype,r),e}();function d(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var f=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.key=r}var t,r;return t=e,(r=[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}])&&d(t.prototype,r),e}();function h(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t,r;return t=e,(r=[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),a=0;a<4;a++)r[a]=t.getUint32(4*a);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix,a=r[0],n=r[1],i=r[2],s=r[3],o=this.invSubMix,u=o[0],c=o[1],l=o[2],d=o[3],f=new Uint32Array(256),h=0,p=0,v=0;for(v=0;v<256;v++)f[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^255&y^99,e[h]=y,t[y]=h;var m=f[h],g=f[m],b=f[g],A=257*f[y]^16843008*y;a[h]=A<<24|A>>>8,n[h]=A<<16|A>>>16,i[h]=A<<8|A>>>24,s[h]=A,A=16843009*b^65537*g^257*m^16843008*h,u[y]=A<<24|A>>>8,c[y]=A<<16|A>>>16,l[y]=A<<8|A>>>24,d[y]=A,h?(h=m^f[f[f[b^m]]],p^=f[f[p]]):h=p=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,a=0;a<t.length&&r;)r=t[a]===this.key[a],a++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var i,s,o,u,c=this.ksRows=4*(n+6+1),l=this.keySchedule=new Uint32Array(c),d=this.invKeySchedule=new Uint32Array(c),f=this.sBox,h=this.rcon,p=this.invSubMix,v=p[0],y=p[1],m=p[2],g=p[3];for(i=0;i<c;i++)i<n?o=l[i]=t[i]:(u=o,i%n==0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=h[i/n|0]<<24):n>6&&i%n==4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),l[i]=o=(l[i-n]^u)>>>0);for(s=0;s<c;s++)i=c-s,u=3&s?l[i]:l[i-4],d[s]=s<4||i<=4?u:v[f[u>>>24]]^y[f[u>>>16&255]]^m[f[u>>>8&255]]^g[f[255&u]],d[s]=d[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r,a){for(var n,i,s,o,u,c,l,d,f,h,p,v,y,m,g,b,A,S=this.keySize+6,w=this.invKeySchedule,k=this.invSBox,T=this.invSubMix,_=T[0],x=T[1],E=T[2],D=T[3],P=this.uint8ArrayToUint32Array_(r),U=P[0],R=P[1],C=P[2],O=P[3],I=new Int32Array(e),L=new Int32Array(I.length),F=this.networkToHostOrderSwap;t<I.length;){for(f=F(I[t]),h=F(I[t+1]),p=F(I[t+2]),v=F(I[t+3]),u=f^w[0],c=v^w[1],l=p^w[2],d=h^w[3],y=4,m=1;m<S;m++)n=_[u>>>24]^x[c>>16&255]^E[l>>8&255]^D[255&d]^w[y],i=_[c>>>24]^x[l>>16&255]^E[d>>8&255]^D[255&u]^w[y+1],s=_[l>>>24]^x[d>>16&255]^E[u>>8&255]^D[255&c]^w[y+2],o=_[d>>>24]^x[u>>16&255]^E[c>>8&255]^D[255&l]^w[y+3],u=n,c=i,l=s,d=o,y+=4;n=k[u>>>24]<<24^k[c>>16&255]<<16^k[l>>8&255]<<8^k[255&d]^w[y],i=k[c>>>24]<<24^k[l>>16&255]<<16^k[d>>8&255]<<8^k[255&u]^w[y+1],s=k[l>>>24]<<24^k[d>>16&255]<<16^k[u>>8&255]<<8^k[255&c]^w[y+2],o=k[d>>>24]<<24^k[u>>16&255]<<16^k[c>>8&255]<<8^k[255&l]^w[y+3],y+=3,L[t]=F(n^U),L[t+1]=F(o^R),L[t+2]=F(s^C),L[t+3]=F(i^O),U=f,R=h,C=p,O=v,t+=4}return a?(A=(b=(g=L.buffer).byteLength)&&new DataView(g).getUint8(b-1))?g.slice(0,b-A):g:L.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}])&&h(t.prototype,r),e}(),v=r(0),y=r(2);function m(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var g=Object(y.a)(),b=function(){function e(t,r){var a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,n=void 0===a||a;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logEnabled=!0,this.observer=t,this.config=r,this.removePKCS7Padding=n,n)try{var i=g.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t,r;return t=e,(r=[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(e,t,r,a){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(v.b.log("JS AES decrypt"),this.logEnabled=!1);var i=this.decryptor;i||(this.decryptor=i=new p),i.expandKey(t),a(i.decrypt(e,0,r,this.removePKCS7Padding))}else{this.logEnabled&&(v.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var s=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new f(s,t)),this.fastAesKey.expandKey().then((function(i){new l(s,r).decrypt(e,i).catch((function(i){n.onWebCryptoError(i,e,t,r,a)})).then((function(e){a(e)}))})).catch((function(i){n.onWebCryptoError(i,e,t,r,a)}))}}},{key:"onWebCryptoError",value:function(e,t,r,i,o){this.config.enableSoftwareAES?(v.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,i,o)):(v.b.error("decrypting error : ".concat(e.message)),this.observer.trigger(a.a.ERROR,{type:n,details:s,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}])&&m(t.prototype,r),e}();function A(e,t){return 255===e[t]&&240==(246&e[t+1])}function S(e,t){return 1&e[t+1]?7:9}function w(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function k(e,t){return!!(t+1<e.length&&A(e,t))}function T(e,t){if(k(e,t)){var r=S(e,t);t+5<e.length&&(r=w(e,t));var a=t+r;if(a===e.length||a+1<e.length&&A(e,a))return!0}return!1}function _(e,t,r,i,s){if(!e.samplerate){var u=function(e,t,r,i){var s,u,c,l,d,f=navigator.userAgent.toLowerCase(),h=i,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(s=1+((192&t[r+2])>>>6),!((u=(60&t[r+2])>>>2)>p.length-1))return l=(1&t[r+2])<<2,l|=(192&t[r+3])>>>6,v.b.log("manifest codec:".concat(i,",ADTS data:type:").concat(s,",sampleingIndex:").concat(u,"[").concat(p[u],"Hz],channelConfig:").concat(l)),/firefox/i.test(f)?u>=6?(s=5,d=new Array(4),c=u-3):(s=2,d=new Array(2),c=u):-1!==f.indexOf("android")?(s=2,d=new Array(2),c=u):(s=5,d=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&u>=6?c=u-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(u>=6&&1===l||/vivaldi/i.test(f))||!i&&1===l)&&(s=2,d=new Array(2)),c=u)),d[0]=s<<3,d[0]|=(14&u)>>1,d[1]|=(1&u)<<7,d[1]|=l<<3,5===s&&(d[1]|=(14&c)>>1,d[2]=(1&c)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:p[u],channelCount:l,codec:"mp4a.40."+s,manifestCodec:h};e.trigger(a.a.ERROR,{type:n,details:o,fatal:!0,reason:"invalid ADTS sampling index:".concat(u)})}(t,r,i,s);e.config=u.config,e.samplerate=u.samplerate,e.channelCount=u.channelCount,e.codec=u.codec,e.manifestCodec=u.manifestCodec,v.b.log("parsed codec:".concat(e.codec,",rate:").concat(u.samplerate,",nb channel:").concat(u.channelCount))}}function x(e){return 9216e4/e}function E(e,t,r,a,n){var i=function(e,t,r,a,n){var i,s,o=e.length;if(i=S(e,t),s=w(e,t),(s-=i)>0&&t+i+s<=o)return{headerLength:i,frameLength:s,stamp:r+a*n}}(t,r,a,n,x(e.samplerate));if(i){var s=i.stamp,o=i.headerLength,u=i.frameLength,c={unit:t.subarray(r+o,r+o+u),pts:s,dts:s};return e.samples.push(c),{sample:c,length:u+o}}}function D(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var P,U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"isHeader",value:function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"isFooter",value:function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"getID3Data",value:function(t,r){for(var a=r,n=0;e.isHeader(t,r);)n+=10,n+=e._readSize(t,r+6),e.isFooter(t,r+10)&&(n+=10),r+=n;if(n>0)return t.subarray(a,a+n)}},{key:"_readSize",value:function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]}},{key:"getTimeStamp",value:function(t){for(var r=e.getID3Frames(t),a=0;a<r.length;a++){var n=r[a];if(e.isTimeStampFrame(n))return e._readTimeStamp(n)}}},{key:"isTimeStampFrame",value:function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}},{key:"_getFrameData",value:function(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]),a=e._readSize(t,4);return{type:r,size:a,data:t.subarray(10,10+a)}}},{key:"getID3Frames",value:function(t){for(var r=0,a=[];e.isHeader(t,r);){for(var n=e._readSize(t,r+6),i=(r+=10)+n;r+8<i;){var s=e._getFrameData(t.subarray(r)),o=e._decodeFrame(s);o&&a.push(o),r+=s.size+10}e.isFooter(t,r)&&(r+=10)}return a}},{key:"_decodeFrame",value:function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0}},{key:"_readTimeStamp",value:function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],a=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return a/=45,r&&(a+=47721858.84),Math.round(a)}}},{key:"_decodePrivFrame",value:function(t){if(!(t.size<2)){var r=e._utf8ArrayToStr(t.data,!0),a=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:a.buffer}}}},{key:"_decodeTextFrame",value:function(t){if(!(t.size<2)){if("TXXX"===t.type){var r=1,a=e._utf8ArrayToStr(t.data.subarray(r),!0);r+=a.length+1;var n=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:a,data:n}}var i=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:i}}}},{key:"_decodeURLFrame",value:function(t){if("WXXX"===t.type){if(t.size<2)return;var r=1,a=e._utf8ArrayToStr(t.data.subarray(r));r+=a.length+1;var n=e._utf8ArrayToStr(t.data.subarray(r));return{key:t.type,info:a,data:n}}var i=e._utf8ArrayToStr(t.data);return{key:t.type,data:i}}},{key:"_utf8ArrayToStr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=R();if(r){var a=r.decode(e);if(t){var n=a.indexOf("\0");return-1!==n?a.substring(0,n):a}return a.replace(/\0/g,"")}for(var i,s,o,u=e.length,c="",l=0;l<u;){if(0===(i=e[l++])&&t)return c;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(i);break;case 12:case 13:s=e[l++],c+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e[l++],o=e[l++],c+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}}return c}}],null&&D(t.prototype,null),r&&D(t,r),e}();function R(){var e=Object(y.a)();return P||void 0===e.TextDecoder||(P=new e.TextDecoder("utf-8")),P}U._utf8ArrayToStr;var C=U;function O(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var I=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=a,this.remuxer=r}var t,r,a;return t=e,a=[{key:"probe",value:function(e){if(!e)return!1;for(var t=(C.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(T(e,t))return v.b.log("ADTS sync word found !"),!0;return!1}}],(r=[{key:"resetInitSegment",value:function(e,t,r,a){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:a,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,r,a){for(var n=this._audioTrack,i=C.getID3Data(e,0)||[],s=C.getTimeStamp(i),o=Number.isFinite(s)?90*s:9e4*t,u=0,c=o,l=e.length,d=i.length,f=[{pts:c,dts:c,data:i}];d<l-1;)if(k(e,d)&&d+5<l){_(n,this.observer,e,d,n.manifestCodec);var h=E(n,e,d,o,u);if(!h){v.b.log("Unable to parse AAC frame");break}d+=h.length,c=h.sample.pts,u++}else C.isHeader(e,d)?(i=C.getID3Data(e,d),f.push({pts:c,dts:c,data:i}),d+=i.length):d++;this.remuxer.remux(n,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,a)}},{key:"destroy",value:function(){}}])&&O(t.prototype,r),a&&O(t,a),e}();function L(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var F=Math.pow(2,32)-1,M=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.remuxer=r}var t,r,n;return t=e,n=[{key:"probe",value:function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0}},{key:"bin2str",value:function(e){return String.fromCharCode.apply(null,e)}},{key:"readUint16",value:function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r}},{key:"readUint32",value:function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r}},{key:"writeUint32",value:function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}},{key:"findBox",value:function(t,r){var a,n,i,s,o,u,c=[];if(t.data?(o=t.start,i=t.end,t=t.data):(o=0,i=t.byteLength),!r.length)return null;for(a=o;a<i;)u=(n=e.readUint32(t,a))>1?a+n:i,e.bin2str(t.subarray(a+4,a+8))===r[0]&&(1===r.length?c.push({data:t,start:a+8,end:u}):(s=e.findBox({data:t,start:a+8,end:u},r.slice(1))).length&&(c=c.concat(s))),a=u;return c}},{key:"parseSegmentIndex",value:function(t){var r,a=e.findBox(t,["moov"])[0],n=a?a.end:null,i=0,s=e.findBox(t,["sidx"]);if(!s||!s[0])return null;r=[];var o=(s=s[0]).data[0];i=0===o?8:16;var u=e.readUint32(s,i);i+=4,i+=0===o?8:16,i+=2;var c=s.end+0,l=e.readUint16(s,i);i+=2;for(var d=0;d<l;d++){var f=i,h=e.readUint32(s,f);f+=4;var p=2147483647&h;if(1==(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=e.readUint32(s,f);f+=4,r.push({referenceSize:p,subsegmentDuration:v,info:{duration:v/u,start:c,end:c+p-1}}),c+=p,i=f+=4}return{earliestPresentationTime:0,timescale:u,version:o,referencesCount:l,references:r,moovEndOffset:n}}},{key:"parseInitSegment",value:function(t){var r=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var a=e.findBox(t,["tkhd"])[0];if(a){var n=a.data[a.start],i=0===n?12:20,s=e.readUint32(a,i),o=e.findBox(t,["mdia","mdhd"])[0];if(o){i=0===(n=o.data[o.start])?12:20;var u=e.readUint32(o,i),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var l={soun:"audio",vide:"video"}[e.bin2str(c.data.subarray(c.start+8,c.start+12))];if(l){var d=e.findBox(t,["mdia","minf","stbl","stsd"]);if(d.length){d=d[0];var f=e.bin2str(d.data.subarray(d.start+12,d.start+16));v.b.log("MP4Demuxer:".concat(l,":").concat(f," found"))}r[s]={timescale:u,type:l},r[l]={timescale:u,id:s}}}}}})),r}},{key:"getStartDTS",value:function(t,r){var a,n,i;return a=e.findBox(r,["moof","traf"]),n=[].concat.apply([],a.map((function(r){return e.findBox(r,["tfhd"]).map((function(a){var n,i;return n=e.readUint32(a,4),i=t[n].timescale||9e4,e.findBox(r,["tfdt"]).map((function(t){var r,a;return r=t.data[t.start],a=e.readUint32(t,4),1===r&&(a*=Math.pow(2,32),a+=e.readUint32(t,8)),a}))[0]/i}))}))),i=Math.min.apply(null,n),isFinite(i)?i:0}},{key:"offsetStartDTS",value:function(t,r,a){e.findBox(r,["moof","traf"]).map((function(r){return e.findBox(r,["tfhd"]).map((function(n){var i=e.readUint32(n,4),s=t[i].timescale||9e4;e.findBox(r,["tfdt"]).map((function(t){var r=t.data[t.start],n=e.readUint32(t,4);if(0===r)e.writeUint32(t,4,n-a*s);else{n*=Math.pow(2,32),n+=e.readUint32(t,8),n-=a*s,n=Math.max(n,0);var i=Math.floor(n/(F+1)),o=Math.floor(n%(F+1));e.writeUint32(t,4,i),e.writeUint32(t,8,o)}}))}))}))}}],(r=[{key:"resetTimeStamp",value:function(e){this.initPTS=e}},{key:"resetInitSegment",value:function(t,r,n,i){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==r&&(r="mp4a.40.5"),null==n&&(n="avc1.42e01e");var o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:r+","+n,initSegment:i?t:null}:(s.audio&&(o.audio={container:"audio/mp4",codec:r,initSegment:i?t:null}),s.video&&(o.video={container:"video/mp4",codec:n,initSegment:i?t:null})),this.observer.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else r&&(this.audioCodec=r),n&&(this.videoCodec=n)}},{key:"append",value:function(t,r,n,i){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var o,u=this.initPTS;if(void 0===u){var c=e.getStartDTS(s,t);this.initPTS=u=c-r,this.observer.trigger(a.a.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(s,t,u),o=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,o,n,i,t)}},{key:"destroy",value:function(){}}])&&L(t.prototype,r),n&&L(t,n),e}(),G={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,a,n){if(!(r+24>t.length)){var i=this.parseHeader(t,r);if(i&&r+i.frameLength<=t.length){var s=a+n*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:t.subarray(r,r+i.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(o),{sample:o,length:i.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,a=e[t+1]>>1&3,n=e[t+2]>>4&15,i=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==r&&0!==n&&15!==n&&3!==i){var o=3===r?3-a:3===a?3:4,u=1e3*G.BitratesMap[14*o+n-1],c=3===r?0:2===r?1:2,l=G.SamplingRateMap[3*c+i],d=e[t+3]>>6==3?1:2,f=G.SamplesCoefficients[r][a],h=G.BytesInSlot[a],p=8*f*h;return{sampleRate:l,channelCount:d,frameLength:parseInt(f*u/l+s,10)*h,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),a=4;r&&r.frameLength&&(a=r.frameLength);var n=t+a;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},N=G;function B(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var j=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var t,r;return t=e,(r=[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,a=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");a.set(e.subarray(r,r+n)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&v.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,r=8,a=8;for(t=0;t<e;t++)0!==a&&(a=(r+this.readEG()+256)%256),r=0===a?r:a}},{key:"readSPS",value:function(){var e,t,r,a,n,i,s,o=0,u=0,c=0,l=0,d=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),v=this.skipBits.bind(this),y=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(d(),e=d(),f(5),v(3),d(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var b=h();if(3===b&&v(1),m(),m(),v(1),p())for(i=3!==b?8:12,s=0;s<i;s++)p()&&g(s<6?16:64)}m();var A=h();if(0===A)h();else if(1===A)for(v(1),y(),y(),t=h(),s=0;s<t;s++)y();m(),v(1),r=h(),a=h(),0===(n=f(1))&&v(1),v(1),p()&&(o=h(),u=h(),c=h(),l=h());var S=[1,1];if(p()&&p())switch(d()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(r+1)-2*o-2*u),height:(2-n)*(a+1)*16-(n?2:4)*(c+l),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}])&&B(t.prototype,r),e}();function H(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var z=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.decryptdata=a,this.discardEPB=n,this.decrypter=new b(t,r,{removePKCS7Padding:!1})}var t,r;return t=e,(r=[{key:"decryptBuffer",value:function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)}},{key:"decryptAacSample",value:function(e,t,r,a){var n=e[t].unit,i=n.subarray(16,n.length-n.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length),o=this;this.decryptBuffer(s,(function(i){i=new Uint8Array(i),n.set(i,16),a||o.decryptAacSamples(e,t+1,r)}))}},{key:"decryptAacSamples",value:function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var a=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,a),!a)return}}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),a=0,n=32;n<=e.length-16;n+=160,a+=16)r.set(e.subarray(n,n+16),a);return r}},{key:"getAvcDecryptedUnit",value:function(e,t){t=new Uint8Array(t);for(var r=0,a=32;a<=e.length-16;a+=160,r+=16)e.set(t.subarray(r,r+16),a);return e}},{key:"decryptAvcSample",value:function(e,t,r,a,n,i){var s=this.discardEPB(n.data),o=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(o.buffer,(function(o){n.data=u.getAvcDecryptedUnit(s,o),i||u.decryptAvcSamples(e,t,r+1,a)}))}},{key:"decryptAvcSamples",value:function(e,t,r,a){for(;;t++,r=0){if(t>=e.length)return void a();for(var n=e[t].units;!(r>=n.length);r++){var i=n[r];if(!(i.length<=48||1!==i.type&&5!==i.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,a,i,s),!s)return}}}}}])&&H(t.prototype,r),e}();function V(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var W={video:1,audio:2,id3:3,text:4},K=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=a,this.typeSupported=n,this.remuxer=r,this.sampleAes=null}var t,r,i;return t=e,i=[{key:"probe",value:function(t){var r=e._syncOffset(t);return!(r<0||(r&&v.b.warn("MPEG2-TS detected but first sync word found @ offset ".concat(r,", junk ahead ?")),0))}},{key:"_syncOffset",value:function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:W[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}}}],(r=[{key:"setDecryptData",value:function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new z(this.observer,this.config,e,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(t,r,a,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",n),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3",n),this._txtTrack=e.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=a,this._duration=n}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,r,i,s){var u,c,l,d,f,h=t.length,p=!1;this.contiguous=i;var y=this.pmtParsed,m=this._avcTrack,g=this._audioTrack,b=this._id3Track,A=m.pid,S=g.pid,w=b.pid,k=this._pmtId,T=m.pesData,_=g.pesData,x=b.pesData,E=this._parsePAT,D=this._parsePMT,P=this._parsePES,U=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),O=this._parseID3PES.bind(this),I=e._syncOffset(t);for(h-=(h+I)%188,u=I;u<h;u+=188)if(71===t[u]){if(c=!!(64&t[u+1]),l=((31&t[u+1])<<8)+t[u+2],(48&t[u+3])>>4>1){if((d=u+5+t[u+4])===u+188)continue}else d=u+4;switch(l){case A:c&&(T&&(f=P(T))&&void 0!==f.pts&&U(f,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,u+188)),T.size+=u+188-d);break;case S:c&&(_&&(f=P(_))&&void 0!==f.pts&&(g.isAAC?R(f):C(f)),_={data:[],size:0}),_&&(_.data.push(t.subarray(d,u+188)),_.size+=u+188-d);break;case w:c&&(x&&(f=P(x))&&void 0!==f.pts&&O(f),x={data:[],size:0}),x&&(x.data.push(t.subarray(d,u+188)),x.size+=u+188-d);break;case 0:c&&(d+=t[d]+1),k=this._pmtId=E(t,d);break;case k:c&&(d+=t[d]+1);var L=D(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(A=L.avc)>0&&(m.pid=A),(S=L.audio)>0&&(g.pid=S,g.isAAC=L.isAAC),(w=L.id3)>0&&(b.pid=w),p&&!y&&(v.b.log("reparse from beginning"),p=!1,u=I-188),y=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(a.a.ERROR,{type:n,details:o,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(f=P(T))&&void 0!==f.pts?(U(f,!0),m.pesData=null):m.pesData=T,_&&(f=P(_))&&void 0!==f.pts?(g.isAAC?R(f):C(f),g.pesData=null):(_&&_.size&&v.b.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=_),x&&(f=P(x))&&void 0!==f.pts?(O(f),b.pesData=null):b.pesData=x,null==this.sampleAes?this.remuxer.remux(g,m,b,this._txtTrack,r,i,s):this.decryptAndRemux(g,m,b,this._txtTrack,r,i,s)}},{key:"decryptAndRemux",value:function(e,t,r,a,n,i,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,r,a,n,i,s)}))}else this.decryptAndRemuxAvc(e,t,r,a,n,i,s)}},{key:"decryptAndRemuxAvc",value:function(e,t,r,a,n,i,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o.remuxer.remux(e,t,r,a,n,i,s)}))}else this.remuxer.remux(e,t,r,a,n,i,s)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,r,a){var n,i,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!a){v.b.log("unknown stream type:"+e[t]);break}case 15:-1===s.audio&&(s.audio=i);break;case 21:-1===s.id3&&(s.id3=i);break;case 219:if(!a){v.b.log("unknown stream type:"+e[t]);break}case 27:-1===s.avc&&(s.avc=i);break;case 3:case 4:r?-1===s.audio&&(s.audio=i,s.isAAC=!1):v.b.log("MPEG audio found, not supported in this browser for now");break;case 36:v.b.warn("HEVC stream type found, not supported for now");break;default:v.b.log("unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s}},{key:"_parsePES",value:function(e){var t,r,a,n,i,s,o,u,c=0,l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;){var d=new Uint8Array(l[0].length+l[1].length);d.set(l[0]),d.set(l[1],l[0].length),l[0]=d,l.splice(1,1)}if(1===((t=l[0])[0]<<16)+(t[1]<<8)+t[2]){if((a=(t[4]<<8)+t[5])&&a>e.size-6)return null;192&(r=t[7])&&((s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)>4294967295&&(s-=8589934592),64&r?((o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>4294967295&&(o-=8589934592),s-o>54e5&&(v.b.warn("".concat(Math.round((s-o)/9e4),"s delta between PTS and DTS, align them")),s=o)):o=s),u=(n=t[8])+9,e.size-=u,i=new Uint8Array(e.size);for(var f=0,h=l.length;f<h;f++){var p=(t=l[f]).byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}i.set(t,c),c+=p}return a&&(a-=n+3),{data:i,pts:s,dts:o,len:a}}return null}},{key:"pushAccesUnit",value:function(e,t){if(e.units.length&&e.frame){var r=t.samples,a=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(a||this.contiguous)?(e.id=a,r.push(e)):t.dropped++}e.debug.length&&v.b.log(e.pts+"/"+e.dts+":"+e.debug)}},{key:"_parseAVCPES",value:function(e,t){var r,a,n,i=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),u=this.avcSample,c=!1,l=this.pushAccesUnit.bind(this),d=function(e,t,r,a){return{key:e,pts:t,dts:r,units:[],debug:a}};e.data=null,u&&o.length&&!s.audFound&&(l(u,s),u=this.avcSample=d(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:a=!0,u||(u=i.avcSample=d(!0,e.pts,e.dts,"")),u.frame=!0;var o=t.data;if(c&&o.length>4){var f=new j(o).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(u.key=!0)}break;case 5:a=!0,u||(u=i.avcSample=d(!0,e.pts,e.dts,"")),u.key=!0,u.frame=!0;break;case 6:a=!0,(r=new j(i.discardEPB(t.data))).readUByte();for(var h=0,p=0,v=!1,y=0;!v&&r.bytesAvailable>1;){h=0;do{h+=y=r.readUByte()}while(255===y);p=0;do{p+=y=r.readUByte()}while(255===y);if(4===h&&0!==r.bytesAvailable){if(v=!0,181===r.readUByte()&&49===r.readUShort()&&1195456820===r.readUInt()&&3===r.readUByte()){var m=r.readUByte(),g=31&m,b=[m,r.readUByte()];for(n=0;n<g;n++)b.push(r.readUByte()),b.push(r.readUByte()),b.push(r.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(5===h&&0!==r.bytesAvailable){if(v=!0,p>16){var A=[],S=[];for(n=0;n<16;n++)A.push(r.readUByte().toString(16)),3!==n&&5!==n&&7!==n&&9!==n||A.push("-");for(n=16;n<p;n++)S.push(r.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:A.join(""),userData:String.fromCharCode.apply(null,S),userDataBytes:S})}}else if(p<r.bytesAvailable)for(n=0;n<p;n++)r.readUByte()}break;case 7:if(a=!0,c=!0,!s.sps){var w=(r=new j(t.data)).readSPS();s.width=w.width,s.height=w.height,s.pixelRatio=w.pixelRatio,s.sps=[t.data],s.duration=i._duration;var k=t.data.subarray(1,4),T="avc1.";for(n=0;n<3;n++){var _=k[n].toString(16);_.length<2&&(_="0"+_),T+=_}s.codec=T}break;case 8:a=!0,s.pps||(s.pps=[t.data]);break;case 9:a=!1,s.audFound=!0,u&&l(u,s),u=i.avcSample=d(!1,e.pts,e.dts,"");break;case 12:a=!1;break;default:a=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&a&&u.units.push(t)})),t&&u&&(l(u,s),this.avcSample=null)}},{key:"_insertSampleInOrder",value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var a=r-1;a>=0;a--)if(t.pts<e[a].pts){e.splice(a,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e,t=this.avcSample;if(!t||0===t.units.length){var r=this._avcTrack.samples;t=r[r.length-1]}if(t){var a=t.units;e=a[a.length-1]}return e}},{key:"_parseAVCNALu",value:function(e){var t,r,a,n,i=0,s=e.byteLength,o=this._avcTrack,u=o.naluState||0,c=u,l=[],d=-1;for(-1===u&&(d=0,n=31&e[0],u=0,i=1);i<s;)if(t=e[i++],u)if(1!==u)if(t)if(1===t){if(d>=0)a={data:e.subarray(d,i-u-1),type:n},l.push(a);else{var f=this._getLastNalUnit();if(f&&(c&&i<=4-c&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-c)),(r=i-u-1)>0)){var h=new Uint8Array(f.data.byteLength+r);h.set(f.data,0),h.set(e.subarray(0,r),f.data.byteLength),f.data=h}}i<s?(d=i,n=31&e[i],u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(d>=0&&u>=0&&(a={data:e.subarray(d,s),type:n,state:u},l.push(a)),0===l.length){var p=this._getLastNalUnit();if(p){var v=new Uint8Array(p.data.byteLength+e.byteLength);v.set(p.data,0),v.set(e,p.data.byteLength),p.data=v}}return o.naluState=u,l}},{key:"discardEPB",value:function(e){for(var t,r,a=e.byteLength,n=[],i=1;i<a-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;t=a-n.length,r=new Uint8Array(t);var s=0;for(i=0;i<t;s++,i++)s===n[0]&&(s++,n.shift()),r[i]=e[s];return r}},{key:"_parseAACPES",value:function(e){var t,r,i,s,u,c,l,d=this._audioTrack,f=e.data,h=e.pts,p=this.aacOverFlow,y=this.aacLastPTS;if(p){var m=new Uint8Array(p.byteLength+f.byteLength);m.set(p,0),m.set(f,p.byteLength),f=m}for(i=0,u=f.length;i<u-1&&!k(f,i);i++);if(!i||(i<u-1?(c="AAC PES did not start with ADTS header,offset:".concat(i),l=!1):(c="no ADTS header found in AAC PES",l=!0),v.b.warn("parsing error:".concat(c)),this.observer.trigger(a.a.ERROR,{type:n,details:o,fatal:l,reason:c}),!l)){if(_(d,this.observer,f,i,this.audioCodec),r=0,t=x(d.samplerate),p&&y){var g=y+t;Math.abs(g-h)>1&&(v.b.log("AAC: align PTS for overlapping frames by ".concat(Math.round((g-h)/90))),h=g)}for(;i<u;)if(k(f,i)&&i+5<u){var b=E(d,f,i,h,r);if(!b)break;i+=b.length,s=b.sample.pts,r++}else i++;p=i<u?f.subarray(i,u):null,this.aacOverFlow=p,this.aacLastPTS=s}}},{key:"_parseMPEGPES",value:function(e){for(var t=e.data,r=t.length,a=0,n=0,i=e.pts;n<r;)if(N.isHeader(t,n)){var s=N.appendFrame(this._audioTrack,t,n,i,a);if(!s)break;n+=s.length,a++}else n++}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}])&&V(t.prototype,r),i&&V(t,i),e}();function Y(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var J=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=a,this.remuxer=r}var t,r,a;return t=e,a=[{key:"probe",value:function(e){var t,r,a=C.getID3Data(e,0);if(a&&void 0!==C.getTimeStamp(a))for(t=a.length,r=Math.min(e.length-1,t+100);t<r;t++)if(N.probe(e,t))return v.b.log("MPEG Audio sync word found !"),!0;return!1}}],(r=[{key:"resetInitSegment",value:function(e,t,r,a){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:a,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,r,a){for(var n=C.getID3Data(e,0),i=C.getTimeStamp(n),s=i?90*i:9e4*t,o=n.length,u=e.length,c=0,l=0,d=this._audioTrack,f=[{pts:s,dts:s,data:n}];o<u;)if(N.isHeader(e,o)){var h=N.appendFrame(d,e,o,s,c);if(!h)break;o+=h.length,l=h.sample.pts,c++}else C.isHeader(e,o)?(n=C.getID3Data(e,o),f.push({pts:l,dts:l,data:n}),o+=n.length):o++;this.remuxer.remux(d,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,a)}},{key:"destroy",value:function(){}}])&&Y(t.prototype,r),a&&Y(t,a),e}();function X(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}],null&&X(t.prototype,null),r&&X(t,r),e}();function Z(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var $=Math.pow(2,32)-1,Q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=i,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(e){for(var t,r=Array.prototype.slice.call(arguments,1),a=8,n=r.length,i=n;n--;)a+=r[n].byteLength;for((t=new Uint8Array(a))[0]=a>>24&255,t[1]=a>>16&255,t[2]=a>>8&255,t[3]=255&a,t.set(e,4),n=0,a=8;n<i;n++)t.set(r[n],a),a+=r[n].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){r*=t;var a=Math.floor(r/($+1)),n=Math.floor(r%($+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,a){return e.box(e.types.moof,e.mfhd(t),e.traf(a,r))}},{key:"moov",value:function(t){for(var r=t.length,a=[];r--;)a[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(a).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,a=[];r--;)a[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(a))}},{key:"mvhd",value:function(t,r){r*=t;var a=Math.floor(r/($+1)),n=Math.floor(r%($+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(t){var r,a,n=t.samples||[],i=new Uint8Array(4+n.length);for(a=0;a<n.length;a++)r=n[a].flags,i[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,i)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,a,n,i=[],s=[];for(r=0;r<t.sps.length;r++)n=(a=t.sps[r]).byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(a));for(r=0;r<t.pps.length;r++)n=(a=t.pps[r]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(a));var o=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),u=t.width,c=t.height,l=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,a=t.duration*t.timescale,n=t.width,i=t.height,s=Math.floor(a/($+1)),o=Math.floor(a%($+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"traf",value:function(t,r){var a=e.sdtp(t),n=t.id,i=Math.floor(r/($+1)),s=Math.floor(r%($+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,a.length+16+20+8+16+8+8),a)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var a,n,i,s,o,u,c=t.samples||[],l=c.length,d=12+16*l,f=new Uint8Array(d);for(r+=8+d,f.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),a=0;a<l;a++)i=(n=c[a]).duration,s=n.size,o=n.flags,u=n.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*a);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var r,a=e.moov(t);return(r=new Uint8Array(e.FTYP.byteLength+a.byteLength)).set(e.FTYP),r.set(a,e.FTYP.byteLength),r}}],null&&Z(t.prototype,null),r&&Z(t,r),e}();function ee(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var te=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.typeSupported=a;var i=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&i&&!i.match("CriOS"),this.ISGenerated=!1}var t,r;return t=e,(r=[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this._initPTS=this._initDTS=e}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,n,i,s,o){if(this.ISGenerated||this.generateIS(e,t,i),this.ISGenerated){var u=e.samples.length,c=t.samples.length,l=i,d=i;if(u&&c){var f=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;l+=Math.max(0,f),d+=Math.max(0,-f)}if(u){e.timescale||(v.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,i));var h,p=this.remuxAudio(e,l,s,o);c&&(p&&(h=p.endPTS-p.startPTS),t.timescale||(v.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,d,s,h,o))}else if(c){var y=this.remuxVideo(t,d,s,0,o);y&&e.codec&&this.remuxEmptyAudio(e,l,s,y)}}r.samples.length&&this.remuxID3(r,i),n.samples.length&&this.remuxText(n,i),this.observer.trigger(a.a.FRAG_PARSED)}},{key:"generateIS",value:function(e,t,r){var i,s,u=this.observer,c=e.samples,l=t.samples,d=this.typeSupported,f="audio/mp4",h={},p={tracks:h},y=void 0===this._initPTS;if(y&&(i=s=1/0),e.config&&c.length&&(e.timescale=e.samplerate,v.b.log("audio sampling rate : ".concat(e.samplerate)),e.isAAC||(d.mpeg?(f="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),h.audio={container:f,codec:e.codec,initSegment:!e.isAAC&&d.mpeg?new Uint8Array:Q.initSegment([e]),metadata:{channelCount:e.channelCount}},y&&(i=s=c[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&l.length){var m=t.inputTimeScale;t.timescale=m,h.video={container:"video/mp4",codec:t.codec,initSegment:Q.initSegment([t]),metadata:{width:t.width,height:t.height}},y&&(i=Math.min(i,l[0].pts-m*r),s=Math.min(s,l[0].dts-m*r),this.observer.trigger(a.a.INIT_PTS_FOUND,{initPTS:i}))}Object.keys(h).length?(u.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,y&&(this._initPTS=i,this._initDTS=s)):u.trigger(a.a.ERROR,{type:n,details:o,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,r,n,s){var o,c,l,d,f,h,p,y=8,m=e.timescale,g=e.samples,b=[],A=g.length,S=this._PTSNormalize,w=this._initPTS,k=this.nextAvcDts,T=this.isSafari;if(0!==A){T&&(r|=g.length&&k&&(s&&Math.abs(t-k/m)<.1||Math.abs(g[0].pts-k-w)<m/5)),r||(k=t*m),g.forEach((function(e){e.pts=S(e.pts-w,k),e.dts=S(e.dts-w,k)})),g.sort((function(e,t){var r=e.dts-t.dts,a=e.pts-t.pts;return r||a||e.id-t.id}));var _=g.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(_<0){v.b.warn("PTS < DTS detected in video samples, shifting DTS by ".concat(Math.round(_/90)," ms to overcome this issue"));for(var x=0;x<g.length;x++)g[x].dts+=_}var E=g[0];f=Math.max(E.dts,0),d=Math.max(E.pts,0);var D=Math.round((f-k)/90);r&&D&&(D>1?v.b.log("AVC:".concat(D," ms hole between fragments detected,filling it")):D<-1&&v.b.log("AVC:".concat(-D," ms overlapping between fragments detected")),f=k,g[0].dts=f,d=Math.max(d-D,k),g[0].pts=d,v.b.log("Video/PTS/DTS adjusted: ".concat(Math.round(d/90),"/").concat(Math.round(f/90),",delta:").concat(D," ms"))),E=g[g.length-1],p=Math.max(E.dts,0),h=Math.max(E.pts,0,p),T&&(o=Math.round((p-f)/(g.length-1)));for(var P=0,U=0,R=0;R<A;R++){for(var C=g[R],O=C.units,I=O.length,L=0,F=0;F<I;F++)L+=O[F].data.length;U+=L,P+=I,C.length=L,C.dts=T?f+R*o:Math.max(C.dts,f),C.pts=Math.max(C.pts,C.dts)}var M=U+4*P+8;try{c=new Uint8Array(M)}catch(e){return void this.observer.trigger(a.a.ERROR,{type:i,details:u,fatal:!1,bytes:M,reason:"fail allocating video mdat ".concat(M)})}var G=new DataView(c.buffer);G.setUint32(0,M),c.set(Q.types.mdat,4);for(var N=0;N<A;N++){for(var B=g[N],j=B.units,H=0,z=void 0,V=0,W=j.length;V<W;V++){var K=j[V],Y=K.data,J=K.data.byteLength;G.setUint32(y,J),y+=4,c.set(Y,y),y+=J,H+=4+J}if(T)z=Math.max(0,o*Math.round((B.pts-B.dts)/o));else{if(N<A-1)o=g[N+1].dts-B.dts;else{var X=this.config,q=B.dts-g[N>0?N-1:N].dts;if(X.stretchShortVideoTrack){var Z=X.maxBufferHole,$=Math.floor(Z*m),ee=(n?d+n*m:this.nextAudioPts)-B.pts;ee>$?((o=ee-q)<0&&(o=q),v.b.log("It is approximately ".concat(ee/90," ms to the next segment; using duration ").concat(o/90," ms for the last video frame."))):o=q}else o=q}z=Math.round(B.pts-B.dts)}b.push({size:H,duration:o,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=p+o;var te=e.dropped;if(e.nbNalu=0,e.dropped=0,b.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var re=b[0].flags;re.dependsOn=2,re.isNonSync=0}e.samples=b,l=Q.moof(e.sequenceNumber++,f,e),e.samples=[];var ae={data1:l,data2:c,startPTS:d/m,endPTS:(h+o)/m,startDTS:f/m,endDTS:this.nextAvcDts/m,type:"video",hasAudio:!1,hasVideo:!0,nb:b.length,dropped:te};return this.observer.trigger(a.a.FRAG_PARSING_DATA,ae),ae}}},{key:"remuxAudio",value:function(e,t,r,n){var s,o,c,l,d,f,h=e.inputTimeScale,p=e.timescale,y=h/p,m=(e.isAAC?1024:1152)*y,g=this._PTSNormalize,b=this._initPTS,A=!e.isAAC&&this.typeSupported.mpeg,S=A?0:8,w=e.samples,k=[],T=this.nextAudioPts;if(r|=w.length&&T&&(n&&Math.abs(t-T/h)<.1||Math.abs(w[0].pts-T-b)<20*m),w.forEach((function(e){e.pts=e.dts=g(e.pts-b,t*h)})),0!==(w=w.filter((function(e){return e.pts>=0}))).length){if(r||(T=n?t*h:w[0].pts),e.isAAC)for(var _=this.config.maxAudioFramesDrift,x=0,E=T;x<w.length;){var D,P=w[x];D=P.pts-E;var U=Math.abs(1e3*D/h);if(D<=-_*m)v.b.warn("Dropping 1 audio frame @ ".concat((E/h).toFixed(3),"s due to ").concat(Math.round(U)," ms overlap.")),w.splice(x,1);else if(D>=_*m&&U<1e4&&E){var R=Math.round(D/m);v.b.warn("Injecting ".concat(R," audio frame @ ").concat((E/h).toFixed(3),"s due to ").concat(Math.round(1e3*D/h)," ms gap."));for(var C=0;C<R;C++){var O=Math.max(E,0);(o=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(v.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),o=P.unit.subarray()),w.splice(x,0,{unit:o,pts:O,dts:O}),E+=m,x++}P.pts=P.dts=E,E+=m,x++}else Math.abs(D),P.pts=P.dts=E,E+=m,x++}for(var I=w.length,L=0;I--;)L+=w[I].unit.byteLength;for(var F=0,M=w.length;F<M;F++){var G=w[F],N=G.unit,B=G.pts;if(void 0!==f)s.duration=Math.round((B-f)/y);else{var j=Math.round(1e3*(B-T)/h),H=0;if(r&&e.isAAC&&j){if(j>0&&j<1e4)H=Math.round((B-T)/m),v.b.log("".concat(j," ms hole between AAC samples detected,filling it")),H>0&&((o=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o=N.subarray()),L+=H*o.length);else if(j<-12){v.b.log("drop overlapping AAC sample, expected/parsed/delta:".concat((T/h).toFixed(3),"s/").concat((B/h).toFixed(3),"s/").concat(-j,"ms")),L-=N.byteLength;continue}B=T}if(d=B,!(L>0))return;L+=S;try{c=new Uint8Array(L)}catch(e){return void this.observer.trigger(a.a.ERROR,{type:i,details:u,fatal:!1,bytes:L,reason:"fail allocating audio mdat ".concat(L)})}A||(new DataView(c.buffer).setUint32(0,L),c.set(Q.types.mdat,4));for(var z=0;z<H;z++)(o=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(v.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),o=N.subarray()),c.set(o,S),S+=o.byteLength,s={size:o.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},k.push(s)}c.set(N,S);var V=N.byteLength;S+=V,s={size:V,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},k.push(s),f=B}var W=0;if((I=k.length)>=2&&(W=k[I-2].duration,s.duration=W),I){this.nextAudioPts=T=f+y*W,e.samples=k,l=A?new Uint8Array:Q.moof(e.sequenceNumber++,d/y,e),e.samples=[];var K=d/h,Y=T/h,J={data1:l,data2:c,startPTS:K,endPTS:Y,startDTS:K,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.observer.trigger(a.a.FRAG_PARSING_DATA,J),J}return null}}},{key:"remuxEmptyAudio",value:function(e,t,r,a){var n=e.inputTimeScale,i=n/(e.samplerate?e.samplerate:n),s=this.nextAudioPts,o=(void 0!==s?s:a.startDTS*n)+this._initDTS,u=a.endDTS*n+this._initDTS,c=1024*i,l=Math.ceil((u-o)/c),d=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(v.b.warn("remux empty Audio"),d){for(var f=[],h=0;h<l;h++){var p=o+h*c;f.push({unit:d,pts:p,dts:p})}e.samples=f,this.remuxAudio(e,t,r)}else v.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"remuxID3",value:function(e){var t,r=e.samples.length,n=e.inputTimeScale,i=this._initPTS,s=this._initDTS;if(r){for(var o=0;o<r;o++)(t=e.samples[o]).pts=(t.pts-i)/n,t.dts=(t.dts-s)/n;this.observer.trigger(a.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]}},{key:"remuxText",value:function(e){e.samples.sort((function(e,t){return e.pts-t.pts}));var t,r=e.samples.length,n=e.inputTimeScale,i=this._initPTS;if(r){for(var s=0;s<r;s++)(t=e.samples[s]).pts=(t.pts-i)/n;this.observer.trigger(a.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}}])&&ee(t.prototype,r),e}();function re(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ae=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t}var t,r;return t=e,(r=[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(e,t,r,n,i,s,o,u){var c=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),c.trigger(a.a.FRAG_PARSING_DATA,{data1:u,startPTS:i,startDTS:i,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),c.trigger(a.a.FRAG_PARSED)}}])&&re(t.prototype,r),e}();function ne(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ie,se=Object(y.a)();try{ie=se.performance.now.bind(se.performance)}catch(e){v.b.debug("Unable to use Performance API on this environment"),ie=se.Date.now}var oe=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.typeSupported=r,this.config=a,this.vendor=n}var t,r;return t=e,(r=[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,r,n,i,s,o,u,c,l,d,f){var h=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new b(this.observer,this.config));var v=ie();p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var p=ie();h.observer.trigger(a.a.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:p}}),h.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),n,i,s,o,u,c,l,d,f)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),n,i,s,o,u,c,l,d,f)}},{key:"pushDecrypted",value:function(e,t,r,i,s,u,c,l,d,f,h,p){var v=this.demuxer;if(!v||(c||l)&&!this.probe(e)){for(var y=this.observer,m=this.typeSupported,g=this.config,b=[{demux:K,remux:te},{demux:M,remux:ae},{demux:I,remux:te},{demux:J,remux:te}],A=0,S=b.length;A<S;A++){var w=b[A],k=w.demux.probe;if(k(e)){var T=this.remuxer=new w.remux(y,g,m,this.vendor);v=new w.demux(y,T,g,m),this.probe=k;break}}if(!v)return void y.trigger(a.a.ERROR,{type:n,details:o,fatal:!0,reason:"no demux matching with content found"});this.demuxer=v}var _=this.remuxer;(c||l)&&(v.resetInitSegment(r,i,s,f),_.resetInitSegment()),c&&(v.resetTimeStamp(p),_.resetTimeStamp(p)),"function"==typeof v.setDecryptData&&v.setDecryptData(t),v.append(e,u,d,h)}}])&&ne(t.prototype,r),e}();t.a=oe},function(e,t,r){"use strict";var a=Object.prototype.hasOwnProperty,n="~";function i(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,a,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,a||e,i),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)a.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,i=r.length,s=new Array(i);a<i;a++)s[a]=r[a].fn;return s},c.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,a,i,s){var o=n?n+e:e;if(!this._events[o])return!1;var u,c,l=this._events[o],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,a),!0;case 5:return l.fn.call(l.context,t,r,a,i),!0;case 6:return l.fn.call(l.context,t,r,a,i,s),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,h=l.length;for(c=0;c<h;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,a);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,a){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||a&&!s.once||r&&s.context!==r||u(this,i);else{for(var o=0,c=[],l=s.length;o<l;o++)(s[o].fn!==t||a&&!s[o].once||r&&s[o].context!==r)&&c.push(s[o]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c},function(e,t,r){function a(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var a=r(r.s=ENTRY_MODULE);return a.default||a}var n="[\\.|\\-|\\+|\\w|/|@]+",i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,a){var o={};o[a]=[];var u=t.toString(),c=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return o;for(var l,d=c[1],f=new RegExp("(\\\\n|\\W)"+s(d)+i,"g");l=f.exec(u);)"dll-reference"!==l[3]&&o[a].push(l[3]);for(f=new RegExp("\\("+s(d)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+i,"g");l=f.exec(u);)e[l[2]]||(o[a].push(l[1]),e[l[2]]=r(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);for(var h,p=Object.keys(o),v=0;v<p.length;v++)for(var y=0;y<o[p[v]].length;y++)h=o[p[v]][y],isNaN(1*h)||(o[p[v]][y]=1*o[p[v]][y]);return o}function u(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:r.m},i=t.all?{main:Object.keys(n.main)}:function(e,t){for(var r={main:[t]},a={main:[]},n={main:{}};u(r);)for(var i=Object.keys(r),s=0;s<i.length;s++){var c=i[s],l=r[c].pop();if(n[c]=n[c]||{},!n[c][l]&&e[c][l]){n[c][l]=!0,a[c]=a[c]||[],a[c].push(l);for(var d=o(e,e[c][l],c),f=Object.keys(d),h=0;h<f.length;h++)r[f[h]]=r[f[h]]||[],r[f[h]]=r[f[h]].concat(d[f[h]])}}return a}(n,e),s="";Object.keys(i).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;i[e][t];)t++;i[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+i.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var c=new window.Blob([s],{type:"text/javascript"});if(t.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),d=new window.Worker(l);return d.objectURL=l,d}},function(e,t,r){e.exports=r(8)},function(e,t,r){"use strict";r.r(t);var a=r(3),n=r(1),i=r(0),s=r(4);t.default=function(e){var t=new s.EventEmitter;t.trigger=function(e){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(a))},t.off=function(e){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(a))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",(function(n){var s=n.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.demuxer=new a.a(t,s.typeSupported,o,s.vendor),Object(i.a)(o.debug),r("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}})),t.on(n.a.FRAG_DECRYPTED,r),t.on(n.a.FRAG_PARSING_INIT_SEGMENT,r),t.on(n.a.FRAG_PARSED,r),t.on(n.a.ERROR,r),t.on(n.a.FRAG_PARSING_METADATA,r),t.on(n.a.FRAG_PARSING_USERDATA,r),t.on(n.a.INIT_PTS_FOUND,r),t.on(n.a.FRAG_PARSING_DATA,(function(t,r){var a=[],n={event:t,data:r};r.data1&&(n.data1=r.data1.buffer,a.push(r.data1.buffer),delete r.data1),r.data2&&(n.data2=r.data2.buffer,a.push(r.data2.buffer),delete r.data2),e.postMessage(n,a)}))}},function(e,t,r){"use strict";r.r(t);var a=r(5),n=r(1),i=r(3),s=r(0),o=r(2);function u(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,l(t).apply(this,arguments))}var r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),r=t,(a=[{key:"trigger",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];this.emit.apply(this,[e,e].concat(r))}}])&&u(r.prototype,a),t}(r(4).EventEmitter);function h(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=Object(o.a)(),v=window.MediaSource||window.WebKitMediaSource||{isTypeSupported:function(){return!1}},y=function(){function e(t,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.id=r;var u=this.observer=new f,c=t.config,l=function(e,r){(r=r||{}).frag=o.frag,r.id=o.id,t.trigger(e,r)};u.on(n.a.FRAG_DECRYPTED,l),u.on(n.a.FRAG_PARSING_INIT_SEGMENT,l),u.on(n.a.FRAG_PARSING_DATA,l),u.on(n.a.FRAG_PARSED,l),u.on(n.a.ERROR,l),u.on(n.a.FRAG_PARSING_METADATA,l),u.on(n.a.FRAG_PARSING_USERDATA,l),u.on(n.a.INIT_PTS_FOUND,l);var d={mp4:v.isTypeSupported("video/mp4"),mpeg:v.isTypeSupported("audio/mpeg"),mp3:v.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(c.enableWorker&&"undefined"!=typeof Worker){var y;s.b.log("demuxing in webworker");try{y=this.w=a(7),this.onwmsg=this.onWorkerMessage.bind(this),y.addEventListener("message",this.onwmsg),y.onerror=function(e){t.trigger(n.a.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},y.postMessage({cmd:"init",typeSupported:d,vendor:h,id:r,config:JSON.stringify(c)})}catch(e){s.b.warn("Error in worker:",e),s.b.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),y&&p.URL.revokeObjectURL(y.objectURL),this.demuxer=new i.a(u,d,c,h),this.w=void 0}}else this.demuxer=new i.a(u,d,c,h)}var t,r;return t=e,(r=[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)}},{key:"push",value:function(e,t,r,a,n,i,o,u){var c=this.w,l=Number.isFinite(n.startPTS)?n.startPTS:n.start,d=n.decryptdata,f=this.frag,h=!(f&&n.cc===f.cc),p=!(f&&n.level===f.level),v=f&&n.sn===f.sn+1,y=!p&&v;if(h&&s.b.log("".concat(this.id,":discontinuity detected")),p&&s.b.log("".concat(this.id,":switch detected")),this.frag=n,c)c.postMessage({cmd:"demux",data:e,decryptdata:d,initSegment:t,audioCodec:r,videoCodec:a,timeOffset:l,discontinuity:h,trackSwitch:p,contiguous:y,duration:i,accurateTimeOffset:o,defaultInitPTS:u},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,d,t,r,a,l,h,p,y,i,o,u)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case n.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}}])&&h(t.prototype,r),e}();function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],a=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(n)throw i}}return r}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"Transmuxer",(function(){return S}));var A=function e(){var t,r;b(this,e);var a=new Promise((function(e,a){t=e,r=a}));return a.resolve=t,a.reject=r,a},S=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).enableWorker,r=void 0!==t&&t;b(this,e),this.transmuxedData_={},this.isTransmuxing_=!1,this.trasmuxedPromise_=null;var a={trigger:function(e,t){var r=this;switch(e){case n.a.ERROR:this.trasmuxedPromise_.reject(t);break;case n.a.FRAG_PARSING_INIT_SEGMENT:Object.keys(t.tracks).map((function(e){var a=t.tracks[e];r.appendToTransmuxedData_(e,a.initSegment)}));break;case n.a.FRAG_PARSING_DATA:[t.data1,t.data2].filter((function(e){return e&&e.length})).forEach((function(e){r.appendToTransmuxedData_(t.type,e)}));break;case n.a.FRAG_PARSED:var a={};for(var i in this.transmuxedData_){var s=this.transmuxedData_[i].reduce((function(e,t){return e+t.length}),0),o=this.transmuxedData_[i].reduce((function(e,t){var r=m(e,2),a=r[0],n=r[1];return n.set(t,a),[a+t.length,n]}),[0,new Uint8Array(s)]),u=m(o,2)[1];a[i]=u}this.trasmuxedPromise_.resolve(a),this.transmuxedData_={},this.isTransmuxing_=!1}},config:{enableWorker:r,enableSoftwareAES:!0,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0}};a.trigger=a.trigger.bind(this),this.hlsMuxer_=new y(a,"main")}var t,r;return t=e,(r=[{key:"appendToTransmuxedData_",value:function(e,t){this.transmuxedData_[e]?this.transmuxedData_[e].push(t):this.transmuxedData_[e]=[t]}},{key:"destroy",value:function(){return Promise.resolve()}},{key:"transmux",value:function(e,t,r){var a=r.audioCodec,n=r.videoCodec,i=r.duration,s=r.level,o=t.start,u={sn:t.sn,cc:0,start:o,startPTS:void 0,decryptData:void 0,level:s};if(!this.isTransmuxing_){this.isTransmuxing_=!0,this.transmuxedData_={},this.trasmuxedPromise_=new A,this.captions_=[];var c=new Uint8Array(e);return this.hlsMuxer_.push(c,[],a,n,u,i,!1,void 0),this.trasmuxedPromise_}}}])&&g(t.prototype,r),e}()}])}}]);